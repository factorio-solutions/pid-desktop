Dobrý den,
měl bych dotaz na Vaše technické oddělení, konkrétně mám problém se SIP protokolem.
Vaše voip používám k prozvánění svých zařízení, čímž jim signalizuji aktuální stav, zařízení je naprogramováno tak, že hovor odmítne. Před několika dny pravděpodobně došlo ke změnám na Vaší straně, protože po zaslání INVITE SIP packetu a odmítnutí hovoru se vaše služba pokouší znovu zavolat na dané číslo, za jednu session, stihnu odmítnout 4-5 hovorů. Dříve služba zkusila zavolat pouze jednou a následně vytimeoutovala se statusem 486 - Busy here.
Nevím jestli je toto nové chování chyba, nebo feature, nicméně je to pro můj případ nevyhovující. Pokusil jsem se tedy reagovat na vzniklou situaci tím, že sám zašlu SIP packet CANCEL, kterým ukončím session, nicméně se mi to nedaří. Jsem si jistý, že se packet zašle, vidím ho ve wiresharku, ale už na něj nedostanu od vašeho serveru žádnou odpověd.
Packet stavím následovně:
{ method: 'CANCEL',
  uri: 'sip:TEL-CISLO-ZARIZENI@sip.802.cz',
  headers:
   { to: { uri: 'sip:TEL-CISLO-ZARIZENI@sip.802.cz', params: {transport: 'UDP'} },
     from: { uri: 'sip:910800031@sip.802.cz', params: {tag: STEJNE-JAKO-V-INVITE} },
     'call-id': STEJNE-JAKO-V-INVITE,
     cseq: { method: 'CANCEL', seq: 2 },
     'max-forwards': 68,
     via: STEJNE-JAKO-V-INVITE,
     'proxy-authorization': STEJNE-JAKO-V-INVITE
   }
}
Některé části packetu jsou závíslé na předchozím INVITE packetu
headers.from.params.tag kopíruji z INVITE, příklad hodnoty '968245'
headers.call-id stejné jako v INVITE, příklad hodnoty '520529'
headers.via kopíruji z INVITE, příklad hodnoty 'SIP/2.0/UDP 10.35.127.107:5060;branch=z9hG4bK837603;rport'
headers.proxy-authorization beru z druhého INVITE po ACK, příklad hodnoty "Digest realm="802.cz",username="910800031",nonce="59bf7e0f00017dd832514b1b8dc1d509a8c77342d3720f12",uri="sip:721325591@sip.802.cz",response="386df887692e5f60c9172589d01fe685""

Poradíte mi, prosím, co dělám špatně? Které hodnoty očekáváte jinak?
Díky, Ing. Tomáš Hrstka
